{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],
  "enabledManagers": [
    "custom.regex"
  ],
  baseBranchPatterns: [
    'test/dev', 'main'
  ],
  'customDatasources': {
    'eks-last-supported': {
      'defaultRegistryUrlTemplate': 'https://endoflife.date/api/v1/products/amazon-eks/',
      'format': 'json',
      'transformTemplates': [
        '{ "releases": [{ "version": $.result.releases[isEol = false]^(releaseDate)[0].name }] }'
      ]
    },
  },
  "customManagers": [
    {
      customType: 'regex',
      description: 'Track versions that have end-of-life (EOL) dates via endoflife.date',
      fileMatch: [
        '\\.rego$',
      ],
      matchStrings: [
        '#\\s*renovate:\\s*datasource=(?<datasource>.*?) depName=(?<depName>.*?)( versioning=(?<versioning>.*?))?\\s.*?_version\\s*=\\s*"(?<currentValue>.*)"',
      ]
    },
    {
      "fileMatch": [
        "(^|/)Dockerfile$",
        "(^|/)Dockerfile\\.[^/]*$"
      ],
      "matchStrings": [
        "#\\srenovate:\\sdatasource=(?<datasource>.*?)( registryUrl=(?<registryUrl>.*?))?( sourceUrl=(?<sourceUrl>.*?))? depName=(?<depName>.*?)( packageName=(?<packageName>.*?))?( versioning=(?<versioning>.*?))?( extractVersion=(?<extractVersion>.*?))?\\s*\\n(ENV|ARG) .*?_VERSION=(?<currentValue>.*)\\s"
      ]
    },
  ],
  "packageRules": [
    {
      "updateTypes": ["major", "minor"],
      "matchPackageNames": ["wiz"],
      'branchPrefix': 'release/',
      'branchName': 'release/{{newVersion}}',
      'commitMessagePrefix': 'release: ',
      'commitMessageTopic': 'Wiz provider to {{newVersion}}',
      'commitMessageExtra': '',
      'prTitle': 'Release: Update Wiz provider to {{newVersion}}',
      'prBodyTemplate': '## Wiz Provider Version Update\\n\\nThis PR updates the Wiz Terraform provider from `{{currentVersion}}` to `{{newVersion}}`.\\n\\n### Changes\\n- Updated `cdktf.json` with new Wiz provider version\\n- This will trigger a release build with version `{{newVersion}}`\\n\\n### Next Steps\\n1. Review the changes\\n2. Merge this PR to create a release\\n3. The release workflow will automatically build and publish the package\\n\\n---\\n*This PR was automatically created by Renovate Bot*'
    },
    {
      description: 'Only update dependencies under /eof when targeting test/dev',
      matchDatasources: [
        'custom.eks-last-supported'
      ],
      matchBaseBranches: [
        'test/dev',
      ],
      matchFileNames: [
        'eof/**',
      ],
    },
  ]
}
