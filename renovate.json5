{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],
  "enabledManagers": [
    "custom.regex"
  ],
  "customDatasources": {
    "eks-supported": {
      "defaultRegistryUrlTemplate": "https://endoflife.date/api/v1/products/amazon-eks/",
      "format": "json",
      "transformTemplates": [
        /* Keep versions still in STANDARD support only */
        "{ \"releases\": { \"version\": $.result.releases[isEol = false]^(releaseDate)[0].name } }"
      ]
    },
  },
  "customManagers": [
    {
      "customType": "regex",
      "fileMatch": [
        "(^|/)cdktf\\.json$"
      ],
      "matchStrings": [
        "[\\s\\S]*?\\\"name\\\": \\\"(?<depName>.*?)\\\",[\\s\\S]*?\\\"source\\\": \\\"(?<registryHost>(?:\\w+\\.\\w+){1,}\\/)?(?<packageName>[^\\.]*?)\\\",[\\s\\S]*?\\\"version\\\": \\\"(?<currentValue>[=><~\\s\\w+\\.\\-]*)\\\""
      ],
      "registryUrlTemplate": "https://{{{registryHost}}}",
      "datasourceTemplate": "terraform-provider"
    },
    {
      "fileMatch": [
        "(^|/)Dockerfile$",
        "(^|/)Dockerfile\\.[^/]*$"
      ],
      "matchStrings": [
        "#\\srenovate:\\sdatasource=(?<datasource>.*?)( registryUrl=(?<registryUrl>.*?))?( sourceUrl=(?<sourceUrl>.*?))? depName=(?<depName>.*?)( packageName=(?<packageName>.*?))?( versioning=(?<versioning>.*?))?( extractVersion=(?<extractVersion>.*?))?\\s*\\n(ENV|ARG) .*?_VERSION=(?<currentValue>.*)\\s"
      ]
    },
  {
      customType: 'regex',
      description: 'Track versions that have end-of-life (EOL) dates via endoflife.date',
      fileMatch: [
        '(^|/).+?\\.rego$',
      ],
      matchStrings: [
        '#\\s*renovate:\\s*datasource=(?<datasource>.*?) depName=(?<depName>.*?)( versioning=(?<versioning>.*?))?\\s.*?_version\\s*=\\s*"(?<currentValue>.*)"',
      ],
      "datasourceTemplate": "custom.eks-supported",
      versioningTemplate: '{{#if versioning}}{{{versioning}}}{{/if}}',
    },
  ],
  "packageRules": [
    {
      "updateTypes": ["major", "minor"],
      "matchPackageNames": ["wiz"]
    },
    {
      matchDatasources: [
        'endoflife-date',
      ],
      matchPackageNames: [
        'amazon-eks',
      ],
      extractVersion: '^(?<version>.*)-eks.+$',
    },
  ]
}
